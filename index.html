<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>NASS E-Library</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f8f8f8; padding: 20px; }
    h1 { text-align: center; }
    ul { list-style-type: none; padding-left: 20px; }
    li { margin: 5px 0; cursor: pointer; }
    .folder { font-weight: bold; }
    .hidden { display: none; }
    a { text-decoration: none; color: #007bff; }
  </style>
</head>
<body>

<h1>NASS E-Library</h1>
<div id="library"></div>

<script>
async function loadLibrary() {
    const response = await fetch('index.json'); // Must be in same repo
    const data = await response.json();
    const container = document.getElementById('library');

    function createNode(name, isFolder, link) {
        const li = document.createElement('li');
        if (isFolder) li.classList.add('folder');
        if (link) {
            const a = document.createElement('a');
            a.href = link;
            a.target = "_blank";
            a.textContent = name;
            li.appendChild(a);
        } else {
            li.textContent = name;
        }
        return li;
    }

    function buildTree(item, parent) {
        if (item.departments) {
            // Root: departments array
            item.departments.forEach(dept => buildTree(dept, parent));
        } else if (item.parts) {
            // Department with parts
            const li = createNode(item.name, true);
            const ul = document.createElement('ul');
            ul.classList.add('hidden');
            li.addEventListener('click', () => ul.classList.toggle('hidden'));
            parent.appendChild(li);
            parent.appendChild(ul);
            item.parts.forEach(part => buildTree(part, ul));
        } else if (item.levels) {
            // Part or department without parts
            const li = createNode(item.name, true);
            const ul = document.createElement('ul');
            ul.classList.add('hidden');
            li.addEventListener('click', () => ul.classList.toggle('hidden'));
            parent.appendChild(li);
            parent.appendChild(ul);
            item.levels.forEach(level => {
                const levelLi = createNode(level.name, true);
                const semUl = document.createElement('ul');
                semUl.classList.add('hidden');
                levelLi.addEventListener('click', () => semUl.classList.toggle('hidden'));
                ul.appendChild(levelLi);
                ul.appendChild(semUl);

                const courses = level.courses || [];
                const mid = Math.ceil(courses.length / 2);
                const semesters = [
                    { name: "Harmattan Semester", courses: courses.slice(0, mid) },
                    { name: "Rain Semester", courses: courses.slice(mid) }
                ];

                semesters.forEach(sem => {
                    const semLi = createNode(sem.name, true);
                    const courseUl = document.createElement('ul');
                    courseUl.classList.add('hidden');
                    semLi.addEventListener('click', () => courseUl.classList.toggle('hidden'));
                    sem.courses.forEach(course => {
                        const courseLi = createNode(course.name, true);
                        const resUl = document.createElement('ul');
                        resUl.classList.add('hidden');
                        courseLi.addEventListener('click', () => resUl.classList.toggle('hidden'));
                        (course.resources || []).forEach(res => {
                            resUl.appendChild(createNode(res.name, false, res.link));
                        });
                        courseUl.appendChild(courseLi);
                        courseUl.appendChild(resUl);
                    });
                    semUl.appendChild(semLi);
                    semUl.appendChild(courseUl);
                });
            });
        }
    }

    buildTree(data, container);
}

loadLibrary();
</script>

</body>
</html>
